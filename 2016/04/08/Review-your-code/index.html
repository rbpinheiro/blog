<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Review your code · Rafael Pinheiro</title><meta name="description" content="Review your code - Rafael Pinheiro"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/blog/favicon.png"><link rel="stylesheet" href="/blog/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://rbpinheiro.github.io/atom.xml" title="Rafael Pinheiro"></head><body><div class="wrap"><header><h1><a href="/blog/" title="Rafael Pinheiro" class="logo-link"><img src="/blog/favicon.png" alt="Rafael Pinheiro"></a></h1><ul class="nav nav-list"><li class="nav-list-item"><a href="/blog/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/blog/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://twitter.com/rbpinheiro" target="_blank" class="nav-list-link">TWITTER</a></li><li class="nav-list-item"><a href="https://github.com/rbpinheiro" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/blog/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Review your code</h1><div class="post-info">Apr 8, 2016 - 7 min. read</div><div class="post-content"><p>As I finish writing this post, I will review it to check if I can structure it better or if I need to improve the way I am explaining my ideas, and of course for typos and mistakes. This should be the way you write code as well. You are not done when your code works, you are done when your code looks nice.</p>
<p>How many characters in length do you let your lines go? How well do you organise your code? Is your code open to future demands in features or will the team have to rewrite most of it from scratch? Take some pride on how your code looks.</p>
<p>Other people will see it and you might need to work on it again. When coming back to fix a bug you are not in the same mindset you were when first spending hours or days working on that feature. Review your code to leave it for the future you, so you can read it easily enough.</p>
<p>By spending some extra time reviewing what you did when your focus was to develop the logic of how things would work and taking care of bugs, you can focus on other important stuff. Did you miss a situation where a bug might show up later? Is your code good enough in case you need to extend it later?<br><a id="more"></a></p>
<p>I will try to bring it to a more practical scenario and review a real piece of code that I wrote. I like to keep my ajax calls to the server centralized, so in future when I need to change something on how the calls are made I have it all in one place, and not lost somewhere in the code.</p>
<p>There is a file called “api.js” in a project I am working on, if it grows too much I will split it into multiple files inside an “api” folder. But for now let’s just review it and check if we can make it better.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> BASE = <span class="string">'http://localhost:8000/api/v1'</span>;</div><div class="line"><span class="keyword">const</span> postOptions = &#123;</div><div class="line">  <span class="attr">method</span>  : <span class="string">'POST'</span>,</div><div class="line">  <span class="attr">headers</span> : &#123; <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span> &#125;,</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> todos = &#123;</div><div class="line">  <span class="attr">list</span>: <span class="keyword">async</span> () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(BASE + <span class="string">'/todos'</span>);</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (response.status !== <span class="number">200</span>) &#123;</div><div class="line">      <span class="keyword">throw</span> response;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> response.json();</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">create</span>: <span class="keyword">async</span> (payload) =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(BASE + <span class="string">'/todos'</span>, &#123;</div><div class="line">      ...postOptions,</div><div class="line">      <span class="attr">body</span>: <span class="built_in">JSON</span>.stringify(payload)</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (response.status !== <span class="number">200</span>) &#123;</div><div class="line">      <span class="keyword">throw</span> response;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> response.json();</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> auth = &#123;</div><div class="line">  <span class="attr">login</span>: <span class="keyword">async</span> (payload) =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(BASE + <span class="string">'/auth/login'</span>, &#123;</div><div class="line">      ...postOptions,</div><div class="line">      <span class="attr">body</span>: <span class="built_in">JSON</span>.stringify(payload)</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (response.status !== <span class="number">200</span>) &#123;</div><div class="line">      <span class="keyword">throw</span> response;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> response.json();</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>You can see there that I keep the base url for the server on a string and some default options for when making a post call. I am <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Statements/export" target="_blank" rel="external">exporting</a> some objects that handles the calls separated by domains and uses the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch" target="_blank" rel="external">fetch API</a>. Also some <a href="https://jakearchibald.com/2014/es7-async-functions/" target="_blank" rel="external">async magic</a> there and using the <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/Spread_operator" target="_blank" rel="external">spread operator</a> to create new objects extending existing ones.</p>
<p>Let’s take it one improvement at a time. First let’s move what belongs into a configuration file to it’s place. Luckily I already have a config file set up.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">'./config'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> BASE = config.apiUrl;</div><div class="line"><span class="keyword">const</span> postOptions = &#123;</div><div class="line">  <span class="attr">method</span>  : <span class="string">'POST'</span>,</div><div class="line">  <span class="attr">headers</span> : &#123; <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span> &#125;,</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> todos = &#123;</div><div class="line">  <span class="attr">list</span>: <span class="keyword">async</span> () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(BASE + <span class="string">'/todos'</span>);</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (response.status !== <span class="number">200</span>) &#123;</div><div class="line">      <span class="keyword">throw</span> response;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> response.json();</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">create</span>: <span class="keyword">async</span> (payload) =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(BASE + <span class="string">'/todos'</span>, &#123;</div><div class="line">      ...postOptions,</div><div class="line">      <span class="attr">body</span>: <span class="built_in">JSON</span>.stringify(payload)</div><div class="line">    <span class="keyword">if</span> (response.status !== <span class="number">200</span>) &#123;</div><div class="line">      <span class="keyword">throw</span> response;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> response.json();</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> auth = &#123;</div><div class="line">  <span class="attr">login</span>: <span class="keyword">async</span> (payload) =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(BASE + <span class="string">'/auth/login'</span>, &#123;</div><div class="line">      ...postOptions,</div><div class="line">      <span class="attr">body</span>: <span class="built_in">JSON</span>.stringify(payload)</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (response.status !== <span class="number">200</span>) &#123;</div><div class="line">      <span class="keyword">throw</span> response;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> response.json();</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>The API url is now being fetched from the configuration. But I am still calling fetch on a lot of places there, and when different api calls are necessary we will have even more fetch calls. That is not good, the same reasoning that makes me wanna keep all my ajax call on the same place makes me wanna avoid multiple calls to the same api (the fetch API in this case). If I ever need to update the way I am making this call I will have multiple ones, so let’s make it a single one and reuse that.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">'./config'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> BASE = config.apiUrl;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">path</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">async</span> () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(BASE + path);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (response.status !== <span class="number">200</span>) &#123;</div><div class="line">      <span class="keyword">throw</span> response;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> response.json();</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">post</span>(<span class="params">path</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">async</span> (payload) =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(BASE + path, &#123;</div><div class="line">      <span class="attr">method</span>  : <span class="string">'POST'</span>,</div><div class="line">      <span class="attr">headers</span> : &#123; <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span> &#125;,</div><div class="line">      <span class="attr">body</span>    : <span class="built_in">JSON</span>.stringify(payload)</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (response.status !== <span class="number">200</span>) &#123;</div><div class="line">      <span class="keyword">throw</span> response;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> response.json();</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> todos = &#123;</div><div class="line">  <span class="attr">list</span>: get(<span class="string">'/todos'</span>),</div><div class="line">  <span class="attr">create</span>: post(<span class="string">'/todos'</span>)</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> auth = &#123;</div><div class="line">  <span class="attr">login</span>: post(<span class="string">'/auth/login'</span>)</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>I used <a href="http://www.sitepoint.com/currying-in-functional-javascript/" target="_blank" rel="external">currying</a> and <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Functions/Arrow_functions" target="_blank" rel="external">arrow functions</a> to create functions that handles get and post calls to the api. Now we need to write much less code when creating a new call, and if I ever need to change the calls to add a dynamic variable such as api version or keys to the calls I just need to do that in the new get and post functions instead of fixing lots of repeated code.</p>
<p>But we still have a lot of code there that we have to get past when reading the file later and that will require low to zero maintenance, so we can move that somewhere else and transform this file into route declarations for api. I will create an API handling class in my lib folder.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Api</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span> (baseUrl) &#123;</div><div class="line">    <span class="keyword">this</span>.baseUrl = baseUrl;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  get(path) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">async</span> () =&gt; &#123;</div><div class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(<span class="keyword">this</span>.baseUrl + path);</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (response.status !== <span class="number">200</span>) &#123;</div><div class="line">        <span class="keyword">throw</span> response;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">return</span> response.json();</div><div class="line">    &#125;;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  post(path) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (payload) =&gt; &#123;</div><div class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(<span class="keyword">this</span>.baseUrl + path, &#123;</div><div class="line">        <span class="attr">method</span>  : <span class="string">'POST'</span>,</div><div class="line">        <span class="attr">headers</span> : &#123; <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span> &#125;,</div><div class="line">        <span class="attr">body</span>    : <span class="built_in">JSON</span>.stringify(payload)</div><div class="line">      &#125;);</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (response.status !== <span class="number">200</span>) &#123;</div><div class="line">        <span class="keyword">throw</span> response;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">return</span> response.json();</div><div class="line">    &#125;;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Now we can even handle multiple APIs by providing a different base url.</p>
<p>This is how it looks like now:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">'./config'</span>;</div><div class="line"><span class="keyword">import</span> Api <span class="keyword">from</span> <span class="string">'../lib/api'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> api = <span class="keyword">new</span> Api(config.apiUrl);</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> todos = &#123;</div><div class="line">  <span class="attr">list</span>: api.get(<span class="string">'/todos'</span>),</div><div class="line">  <span class="attr">create</span>: api.post(<span class="string">'/todos'</span>)</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> auth = &#123;</div><div class="line">  <span class="attr">login</span>: api.post(<span class="string">'/auth/login'</span>)</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>That is way more maintainable, when someone needs to add a new route it’s way easier than before. Anyone that looks at it knows how to do it.</p>
<hr>
<p><a href="https://medium.com/@rbpinheiro/review-your-code-6e43da2f4aba" target="_blank" rel="external">Review your code</a> was originally published on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>
</div></article></div></main><footer><div class="paginator"><a href="/blog/2017/08/06/Understanding-objects-in-javascript/" class="prev">PREV</a><a href="/blog/2015/12/03/Netflix-to-save-the-world/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'blog-pq9sn2ksel';
var disqus_identifier = '2016/04/08/Review-your-code/';
var disqus_title = 'Review your code';
var disqus_url = 'https://rbpinheiro.github.io/2016/04/08/Review-your-code/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//blog-pq9sn2ksel.disqus.com/count.js" async></script><div class="copyright"><p>powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a></p></div></footer></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-104159899-1",'auto');ga('send','pageview');</script></body></html>